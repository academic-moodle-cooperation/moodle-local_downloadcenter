define(["jquery","core/str","core/url"],function(e,t,n){var o=function(o){var r=this;this.modnames=o,this.strings={},this.formid=null,this.currentlyshown=!1,this.modlist=null,t.get_strings([{key:"all",component:"moodle"},{key:"none",component:"moodle"},{key:"select",component:"moodle"},{key:"showtypes",component:"backup"},{key:"hidetypes",component:"backup"}]).done(function(t){r.strings.all=t[0],r.strings.none=t[1],r.strings.select=t[2],r.strings.showtypes=t[3],r.strings.hidetypes=t[4];var o=e('div[role="main"] > form .card.block').first();r.formid=o.closest("form").prop("id");var i=r.html_generator("included",r.strings.select);i+=r.row_generator('(<a id="downloadcenter-bytype" href="#">'+r.strings.showtypes+"</a>)","");var s=e(document.createElement("div"));for(var l in s.addClass("grouped_settings section_level block card"),s.html(i),s.insertBefore(o),r.modlist=e(document.createElement("div")),r.modlist.prop("id","mod_select_links"),r.modlist.prop("class","m-l-2"),r.modlist.appendTo(s),r.modlist.hide(),r.modnames)if(r.modnames.hasOwnProperty(l)){var c='<img src="'+n.imageUrl("icon","mod_"+l)+'" class="activityicon" />';i=r.html_generator("mod_"+l,c+r.modnames[l]);var d=e(document.createElement("div"));d.addClass("grouped_settings section_level"),d.html(i),d.appendTo(r.modlist),r.initlinks(d,l)}e("#downloadcenter-all-included").click(function(e){r.helper(e,!0,"item_")}),e("#downloadcenter-none-included").click(function(e){r.helper(e,!1,"item_")}),e("#downloadcenter-bytype").click(function(e){e.preventDefault(),r.toggletypes()})})};return o.prototype.toggletypes=function(){var t=e("#downloadcenter-bytype");this.currentlyshown?t.text(this.strings.showtypes):t.text(this.strings.hidetypes),this.modlist.animate({height:"toggle"},500,"swing"),this.currentlyshown=!this.currentlyshown},o.prototype.initlinks=function(t,n){var o=this;e("#downloadcenter-all-mod_"+n).click(function(e){o.helper(e,!0,"item_",n)}),e("#downloadcenter-none-mod_"+n).click(function(e){o.helper(e,!1,"item_",n)})},o.prototype.helper=function(t,n,o,r){t.preventDefault();var i="";void 0!==r&&(i="item_"+r+"_");var s=o.length;e('input[type="checkbox"]').each(function(t,r){var l=(r=e(r)).prop("name");i&&l.substring(0,i.length)!==i||(l.substring(0,s)===o&&r.prop("checked",n),n&&r.closest(".card.block").find(".form-group:first-child input").prop("checked",n))}),this.formid&&M.form&&M.form.updateFormState(this.formid)},o.prototype.html_generator=function(e,t){var n='<a id="downloadcenter-all-'+e+'" href="#">'+this.strings.all+"</a> / ";return n+='<a id="downloadcenter-none-'+e+'" href="#">'+this.strings.none+"</a>",this.row_generator(t,n)},o.prototype.row_generator=function(e,t){var n='<div class="form-group row fitem downloadcenter_selector">';return n+='<div class="col-md-3"></div>',n+='<div class="col-md-9">',n+='<label><span class="itemtitle">'+e+"</span></label>",n+='<span class="text-nowrap">'+t+"</span>",n+="</div>",n+="</div>"},{init:function(e){return new o(e)}}});