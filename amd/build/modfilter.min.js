define(["jquery","core/str","core/url"],function(a,b,c){var d=function(d){var e=this;this.modnames=d,this.strings={},this.formid=null,this.currentlyshown=!1,this.modlist=null,b.get_strings([{key:"all",component:"moodle"},{key:"none",component:"moodle"},{key:"select",component:"moodle"},{key:"showtypes",component:"backup"},{key:"hidetypes",component:"backup"}]).done(function(b){e.strings.all=b[0],e.strings.none=b[1],e.strings.select=b[2],e.strings.showtypes=b[3],e.strings.hidetypes=b[4];var d=a('div[role="main"] > form .card.block').first();e.formid=d.closest("form").prop("id");var f=e.html_generator("included",e.strings.select);f+=e.row_generator('(<a id="downloadcenter-bytype" href="#">'+e.strings.showtypes+"</a>)","");var g=a(document.createElement("div"));g.addClass("grouped_settings section_level block card"),g.html(f),g.insertBefore(d),e.modlist=a(document.createElement("div")),e.modlist.prop("id","mod_select_links"),e.modlist.prop("class","m-l-2"),e.modlist.appendTo(g),e.modlist.hide();for(var h in e.modnames)if(e.modnames.hasOwnProperty(h)){var i='<img src="'+c.imageUrl("icon","mod_"+h)+'" class="activityicon" />';f=e.html_generator("mod_"+h,i+e.modnames[h]);var j=a(document.createElement("div"));j.addClass("grouped_settings section_level"),j.html(f),j.appendTo(e.modlist),e.initlinks(j,h)}a("#downloadcenter-all-included").click(function(a){e.helper(a,!0,"item_")}),a("#downloadcenter-none-included").click(function(a){e.helper(a,!1,"item_")}),a("#downloadcenter-bytype").click(function(a){a.preventDefault(),e.toggletypes()})})};return d.prototype.toggletypes=function(){var b=a("#downloadcenter-bytype");this.currentlyshown?b.text(this.strings.showtypes):b.text(this.strings.hidetypes),this.modlist.animate({height:"toggle"},500,"swing"),this.currentlyshown=!this.currentlyshown},d.prototype.initlinks=function(b,c){var d=this;a("#downloadcenter-all-mod_"+c).click(function(a){d.helper(a,!0,"item_",c)}),a("#downloadcenter-none-mod_"+c).click(function(a){d.helper(a,!1,"item_",c)})},d.prototype.helper=function(b,c,d,e){b.preventDefault();var f="";"undefined"!=typeof e&&(f="item_"+e+"_");var g=d.length;a('input[type="checkbox"]').each(function(b,e){e=a(e);var h=e.prop("name");f&&h.substring(0,f.length)!==f||(h.substring(0,g)===d&&e.prop("checked",c),c&&e.closest(".card.block").find(".form-group:first-child input").prop("checked",c))}),this.formid&&M.form&&M.form.updateFormState(this.formid)},d.prototype.html_generator=function(a,b){var c='<a id="downloadcenter-all-'+a+'" href="#">'+this.strings.all+"</a> / ";return c+='<a id="downloadcenter-none-'+a+'" href="#">'+this.strings.none+"</a>",this.row_generator(b,c)},d.prototype.row_generator=function(a,b){var c='<div class="form-group row fitem downloadcenter_selector">';return c+='<div class="col-md-3"></div>',c+='<div class="col-md-9">',c+='<label><span class="itemtitle">'+a+"</span></label>",c+='<span class="text-nowrap">'+b+"</span>",c+="</div>",c+="</div>"},{init:function(a){return new d(a)}}});